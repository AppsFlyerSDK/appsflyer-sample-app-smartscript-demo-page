<!DOCTYPE html>
<html>
  <head>
    <base herf="/" />
    <link href="https://fonts.cdnfonts.com/css/gilroy-bold" rel="stylesheet" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="themes/prism.css" />
    <link rel="stylesheet" href="themes/prism-line-numbers.css" />
    <link rel="stylesheet" href="themes/prism-live.css" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-33607448-26"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-33607448-26");
    </script>
  </head>

  <body>
    <div class="row">
      <div class="column">
        <img src="images/appsflyerlogo.png" alt="AppsFlyer logo" />
      </div>
    </div>
    <h1 class="primary-heading">Game Landing Page Demo w/ Smart Script V2</h1>
    <h2 class="secondary-heading">
      Click on one of the store buttons below in order to fire AppsFlyer click
      event
    </h2>
    <div class="stores-wrapper">
      <a id="steam_link" class="store-image" href="#">
        <img src="images/STEAM_logo.png" alt="play store link" />
      </a>

      <a id="epic_link" class="store-image" href="#">
        <img src="images/epic.png" alt="play store link" />
      </a>

      <a id="quest_link" class="store-image" href="#">
        <img src="images/meta.png" alt="play store link" />
      </a>

      <!-- <a id="microsoft_link" class="store-image" href="#">
        <img src="images/microsoft.jpg" alt="play store link" />
      </a> -->

      <a id="nintendo_link" class="store-image" href="#">
        <img src="images/NintendoSwitch_logo.png" alt="play store link" />
      </a>

      <!-- <a id="playstation_link" class="store-image" href="#">
        <img src="images/PlayStation_Store.png" alt="play store link" />
      </a> -->

      <a id="xbox_link" class="store-image" href="#">
        <img src="images/xbox-game-store-logo.png" alt="play store link" />
      </a>
    </div>
    <div class="url-container">
      <div class="output_url-container">
        <h2>What happens when the page is loaded</h2>
        <ol>
          <li>
            A OneLink URL is generated and then an impression event is fired.
          </li>
          <li>
            URLs are generates for each platform using the
            <code>AF_SMART_SCRIPT.generateDirectClickURL</code> function
            according to the platform array, below are the generated links.
            <br />
            When the game store banners are clicked, these links will be fired
            respectively. <br />
            This will register a click in AppsFlyer system and then redirect
            according to the <code>af_r</code> parameter (which is generated
            from the <code>redirectURL</code> property within the platform
            object.).
          </li>
        </ol>
        <div id="output_url"></div>
      </div>
      <h2 class="secondary-heading">
        Code to implement on your landing page (after the page is loaded)
      </h2>
      <div>
        <pre>
            <textarea id="input_code_for_run" class="prism-live line-numbers language-js fill" spellcheck="false">
//Initializing Smart Script arguments
// TODO: change to your onelink template URL
var oneLinkURL = "https://crossqa.onelink.me/WyIl";
// If a media source key is NOT FOUND on the link and NO default value is found, the script will return a null string

var channel = { keys: ["inchnl"] };
var mediaSource = {keys: ["inmedia", "utm_source"], defaultValue: "game_media_source"};
var campaign = {keys: ["incmp", "utm_campaign"], defaultValue: "game_landing_page"};
var afSub2 = {keys: ["fbclid"]};

//Calling the function after embedding the code will be through a global parameter on the window object called window.AF_SMART_SCRIPT
//Onelink URL is generated
var OL_result = window.AF_SMART_SCRIPT.generateOneLinkURL({
    oneLinkURL,
    afParameters:{
    mediaSource: mediaSource,
    campaign: campaign,
    afSub2: afSub2,
    afCustom: [
        // The following param is mandatory for cross-platform:  
        {paramKey: "af_xplatform", keys: [], defaultValue: "true"} 
        ] 
    }
    
})

var OL_result_url = "No output from script"
if (OL_result) {
        OL_result_url = OL_result.clickURL;            
        // The following command will fire the impression.
        // The impression will fire to https://impressions.onelink.me//....
        // The wait is a temporary bug fix
        setTimeout(() => {
            window.AF_SMART_SCRIPT.fireImpressionsLink();
            console.log("Impression fired"); 
        }, 1000);            
}      
document.getElementById('output_url').innerHTML = OL_result_url;

// TODO: update the appid and redirectURL for each platform
var platforms = {
  steam: {
    platformName: "steam",  
    appid: "1234561", // <--- DON'T FORGET TO USE YOUR OWN appid
    redirectURL:
      "https%3A%2F%2Fstore.steampowered.com%2Fapp%2F1176160%2FSpace_Wars%2F", // <--- DON'T FORGET TO USE YOUR OWN redirect URL (Encoded!)
  },
  epic: {
    platformName: "epic",
    appid: "1234561", // <--- DON'T FORGET TO USE YOUR OWN appid
    redirectURL: "https%3A%2F%2Fstore.epicgames.com%2Fen-US%2Fcollection%2Fmost-popular", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
  },
  quest: {
    platformName: "quest",
    appid: "1234561", // <--- DON'T FORGET TO USE YOUR OWN appid
    redirectURL: "https%3A%2F%2Fwww.oculus.com%2Fexperiences%2Fquest%2F", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
  },
  nintendo: {
    platformName: "nintendo",
    appid: "1234561", // <--- DON'T FORGET TO USE YOUR OWN appid
    redirectURL: "https%3A%2F%2Fwww.nintendo.com%2Fstore%2Fgames%2Fnintendo-switch-games%2F", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
  },
  xbox: {
    platformName: "xbox",
    appid: "1234561", // <--- DON'T FORGET TO USE YOUR OWN appid
    redirectURL: "https%3A%2F%2Fwww.xbox.com%2Fen-US%2Fmicrosoft-store", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
  }
};

document.getElementById("output_url").innerHTML = "";

// iterating the platforms object 
for (const platformKey in platforms) {
  let result_url = "No output from script";
  const platform = platforms[platformKey];
  // generating direct click URL for the platform
  const result = window.AF_SMART_SCRIPT.generateDirectClickURL({
    afParameters: {
      mediaSource: mediaSource,
      channel: channel,
      campaign: campaign,
      afSub2: afSub2
    },
    platform: platform.platformName,
    app_id: platform.appid,
    redirectURL: platform.redirectURL,
  });

  if (result) {
    result_url = result.clickURL;
    // update the href attribute for each store banner
    if (document.getElementById(platformKey + "_link"))
      document
        .getElementById(platformKey + "_link")
        .setAttribute("href", result_url);

    // add the url to the output list of links
    document.getElementById(
      "output_url"
    ).innerHTML += `<b>${platformKey}</b> -> ${result_url} <br/><br/>`;
  }
}    
            </textarea>
        </pre>
        <input
          type="button"
          value="Run Code"
          class="code_button"
          onclick="runTxtAreaCode()"
        />
      </div>
    </div>

    <!-- SCRIPTS -->
    <script
      type="text/javascript"
      src="https://onelinksmartscript.appsflyer.com/onelink-smart-script-latest.js"
    ></script>
    <script
      type="text/javascript"
      src="scripts/onelink-smart-script-latest.js"
    ></script>
    <script src="scripts/prism.js"></script>
    <script src="scripts/prism-line-numbers.js"></script>
    <script src="scripts/prism-live.js"></script>
    <script>
      runTxtAreaCode();

      // set the onClicke to run the code in the code editor
      function runTxtAreaCode() {
        var headID = document.getElementsByTagName("head")[0];
        var newScript = document.createElement("script");
        newScript.type = "text/javascript";
        newScript.text = document.getElementById("input_code_for_run").value;
        headID.appendChild(newScript);
        // Send Google Analytics - Run Script Successful
        gtag("event", "RunScript", {
          event_category: "SmartScriptImpressions",
          event_label: "Success",
        });
      }
    </script>
  </body>
</html>
