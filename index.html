<!DOCTYPE html>
<html>
  <head>
    <base herf="/" />
    <link href="https://fonts.cdnfonts.com/css/gilroy-bold" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <nav class="header">
      <div class="column">
        <img src="images/appsflyerlogo.png" alt="AppsFlyer logo" />
      </div>
    </nav>
    <div class="row container content-container mx-auto col-lg-8">
      <h1 class="primary-heading">Game Landing Page Demo</h1>
      <h2 class="primary-heading">Smart Script V2</h2>
      <h3 class="my-4">
        The Smart Script source code for this page can be found
        <a
          href="https://github.com/AppsFlyerSDK/appsflyer-sample-app-smartscript-demo-page/blob/b80bb570ff7eb6e3885d7def44b9586c86e531d6/index.html#L108-L231"
          >here</a
        >.
      </h3>
      <hr />
      <h4 class="secondary-heading">
        Click on one of the store buttons below in order to fire AppsFlyer click
        event
      </h4>
      <div class="stores-wrapper">
        <a id="ios_link" class="store-image" href="#" target="_blank">
          <img src="images/store_icons/apple.png" alt="Apple Appstore link" />
        </a>

        <a id="android_link" class="store-image" href="#" target="_blank">
          <img
            src="images/store_icons/android.png"
            alt="Google Play store link"
          />
        </a>

        <a id="steam_link" class="store-image" href="#" target="_blank">
          <img src="images/store_icons/steam.png" alt="Steam store link" />
        </a>

        <a id="epic_link" class="store-image" href="#" target="_blank">
          <img src="images/store_icons/epic.png" alt="Epic store link" />
        </a>

        <a id="quest_link" class="store-image" href="#" target="_blank">
          <img
            src="images/store_icons/oculus.png"
            alt="Oculus quest store link"
          />
        </a>
        <!-- <a id="microsoft_link" class="store-image" href="#" target="_blank">
          <img src="images/store_icons/microsoft.png" alt="microsoft store link" />
        </a> -->
        <a id="nintendo_link" class="store-image" href="#" target="_blank">
          <img
            src="images/store_icons/switch.png"
            alt="Nintendo Switch store link"
          />
        </a>
        <a id="playstation_link" class="store-image" href="#" target="_blank">
          <img src="images/store_icons/psn.png" alt="psn store link" />
        </a>
        <a id="xbox_link" class="store-image" href="#" target="_blank">
          <img
            src="images/store_icons/xbox.png"
            alt="Xbox Microsoft store link"
          />
        </a>
      </div>
      <div class="url-container">
        <div class="output_url-container">
          <h3 class="my-4">What happens when the page is loaded</h3>
          <ol>
            <li>
              A OneLink URL is generated and then an impression event is fired.
            </li>
            <li>
              URLs are generates for each platform using the
              <code>AF_SMART_SCRIPT.generateDirectClickURL</code> function
              according to the platform array, below are the generated links.
              <br />
              When the game store banners are clicked, these links will be fired
              respectively. <br />
              This will register a click in AppsFlyer system and then redirect
              according to the <code>af_r</code> parameter (which is generated
              from the <code>redirectURL</code> property within the platform
              object.).
            </li>
          </ol>
          <div id="output_url"></div>
        </div>
      </div>
    </div>
    <!-- SCRIPTS -->
    <script src="./scripts/onelink-smart-script-v2.5.1.js"></script>
    <script>
      // Initializing Smart Script arguments
      // TODO: change to your onelink template URL
      var oneLinkURL = "https://gaming-demo-landing-page.onelink.me/AG7A";
      // If a media source key is NOT FOUND on the link and NO default value is found, the script will return a null string

      var channel = { keys: ["inchnl"] };
      var mediaSource = {
        keys: ["utm_source"],
        defaultValue: "game_media_source",
      };
      var campaign = {
        keys: ["campaign_name", "utm_campaign"],
        defaultValue: "game_landing_page",
      };
      var ad = {
        keys: ["ad_name", "utm_content"],
        defaultValue: "game_ad_name",
      };
      var adset = { keys: ["adset_name"], defaultValue: "game_adset_name" };

      // Calling the function after embedding the code will be through a global parameter on the window object called window.AF_SMART_SCRIPT
      // Onelink URL is generated
      // READ MORE: https://dev.appsflyer.com/hc/docs/dl_smart_script_v2
      var OL_result = window.AF_SMART_SCRIPT.generateOneLinkURL({
        oneLinkURL,
        afParameters: {
          mediaSource: mediaSource,
          campaign: campaign,
          ad: ad,
          adSet: adset,
          afCustom: [
            // The following param is mandatory for cross-platform:
            { paramKey: "af_xplatform", keys: [], defaultValue: "true" },
          ],
        },
      });

      if (OL_result) {
        // The following command will fire the impression.
        // The impression will fire to https://impressions.onelink.me//....
        // The wait is a temporary bug fix
        setTimeout(() => {
          window.AF_SMART_SCRIPT.fireImpressionsLink();
          console.log("Impression fired");
        }, 1000);
      }

      // TODO: update the appid and redirectURL for each platform
      var platforms = {
        steam: {
          platformName: "steam",
          appid: "1234561", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL: "https://store.steampowered.com/app/1176160/Space_Wars/", // <--- DON'T FORGET TO USE YOUR OWN redirect URL (Encoded!)
        },
        epic: {
          platformName: "epic",
          appid: "butterflyer", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL: "https://store.epicgames.com/en-US/", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
        },
        quest: {
          platformName: "quest",
          appid: "questtest", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL: "https://www.oculus.com/experiences/quest/", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
        },
        nintendo: {
          platformName: "switch",
          appid: "12345123451234", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL: "https://www.nintendo.com/store/", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
        },
        xbox: {
          platformName: "xbox",
          appid: "x1b2o3x4t5e6", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL: "https://www.xbox.com/en-US/microsoft-store", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
        },
        playstation: {
          platformName: "playstation",
          appid: "psn-test", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL: "https://store.playstation.com/en-il/pages/latest", // <--- DON'T FORGET TO USE YOUR OWN redirectURL (Encoded!)
        },
        android: {
          platformName: "android",
          appid: "com.appsflyer.onelinksimulator", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL:
            "https://play.google.com/store/apps/details?id=com.appsflyer.onelinksimulator&hl=en&gl=US", // <--- redirect URL is irrelevant for iOS & Android
        },
        ios: {
          platformName: "ios",
          appid: "id1550796743", // <--- DON'T FORGET TO USE YOUR OWN appid
          redirectURL:
            "https://apps.apple.com/us/app/onelink-simulator/id1550796743", // <--- redirect URL is irrelevant for iOS & Android
        },
      };

      // iterating the platforms object
      for (const platformKey in platforms) {
        let result_url = "No output from script";
        const platform = platforms[platformKey];
        // generating direct click URL for the platform
        // READ MORE: https://dev.appsflyer.com/hc/docs/create-direct-click-url
        const result = window.AF_SMART_SCRIPT.generateDirectClickURL({
          afParameters: {
            mediaSource: mediaSource,
            channel: channel,
            campaign: campaign,
          },
          platform: platform.platformName,
          app_id: platform.appid,
          redirectURL: platform.redirectURL,
        });

        if (result) {
          result_url = result.clickURL;
          // update the href attribute for each store banner
          if (document.getElementById(platformKey + "_link"))
            document
              .getElementById(platformKey + "_link")
              .setAttribute("href", result_url);

          // add the url to the output list of links
          document.getElementById(
            "output_url"
          ).innerHTML += `<b>${platformKey}</b> -> ${result_url} <br/><br/>`;
        }
      }
    </script>
  </body>
</html>
